<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>One-Cut Crease Explorer (Demo)</title>

  <!-- Global site style (header/nav) -->
  <link rel="stylesheet" href="../../../assets/css/site.css" />
  <!-- Playground local style (keep the app UI look) -->
  <link rel="stylesheet" href="style.css" />
</head>

<body class="playground">
  <header class="site-header">
    <div class="site-logo">
      <span class="logo-mark">HI</span>
      <span class="logo-text">Hiro</span>
    </div>

    <nav class="site-nav" aria-label="Site navigation">
      <a href="../../../" class="nav-link">Top</a>
      <a href="../../" class="nav-link">Studies</a>
      <a href="../" class="nav-link">Origami App</a>
      <a class="nav-link active" href="./">Playground</a>
    </nav>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <section class="panel">
        <h2>Tools</h2>
        <div class="toolbar">
          <button class="tool" data-tool="select" id="toolSelect" title="Select & edit">Select</button>
          <button class="tool" data-tool="pen" id="toolPen" title="Draw straight segments (click points, Enter to close polygon, Esc to finish as polyline)">Pen</button>
          <button class="tool" data-tool="rect" id="toolRect" title="Drag to create a rectangle">Rectangle</button>
          <button class="tool" data-tool="ngon" id="toolNgon" title="Drag to create a regular polygon">Regular polygon</button>
        </div>

        <div class="field">
          <label>Regular polygon sides
            <input type="number" id="ngonSides" min="3" max="40" step="1" value="6" />
          </label>
        </div>

        <div class="row">
          <button id="btnUndo" class="btn">Undo</button>
          <button id="btnRedo" class="btn">Redo</button>
          <button id="btnDelete" class="btn btn--danger">Delete</button>
        </div>
      </section>

      <section class="panel">
        <h2>Grid</h2>
        <div class="field">
          <label><input type="checkbox" id="chkGrid" checked /> Show</label>
        </div>
        <div class="field">
          <label><input type="checkbox" id="chkSnap" checked /> Snap</label>
        </div>
        <div class="field">
          <label>Spacing
            <input type="number" id="gridSize" min="5" max="200" step="5" value="25" />
          </label>
        </div>
      </section>

      <section class="panel">
        <h2>Run</h2>
        <div class="row">
          <button id="btnRun" class="btn btn--primary">Run</button>
          <button id="btnClearResult" class="btn">Clear result</button>
        </div>
        <div class="hint">
          * Internet is required for Run (Straight Skeleton is loaded from a CDN).
        </div>
      </section>

      <section class="panel">
        <h2>Save & export</h2>
        <div class="row">
          <button id="btnSaveLocal" class="btn">Save locally</button>
          <button id="btnLoadLocal" class="btn">Load locally</button>
        </div>
        <div class="row">
          <button id="btnExportProject" class="btn">Project JSON</button>
          <button id="btnImportProject" class="btn">Import</button>
          <input type="file" id="fileImport" accept="application/json" hidden />
        </div>
        <div class="row">
          <button id="btnExportSVG" class="btn">Export SVG</button>
          <button id="btnExportPattern" class="btn">Result JSON</button>
        </div>
      </section>

      <section class="panel">
        <h2>Status</h2>
        <div id="status" class="status"></div>
        <div id="error" class="error" hidden></div>
        <div class="legend">
          <div class="legend__item"><span class="sw sw--m"></span> Mountain (M)</div>
          <div class="legend__item"><span class="sw sw--v"></span> Valley (V)</div>
          <div class="legend__item"><span class="sw sw--c"></span> Cut line (one-cut)</div>
          <div class="legend__item"><span class="sw sw--shape"></span> Input shape</div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="helpBtn" type="button">Help</button>
        </div>
      </section>
    </aside>

    <section class="canvasWrap">
      <svg id="canvas" class="canvas" viewBox="0 0 1000 700" tabindex="0" aria-label="drawing canvas">
        <defs>
          <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.2" />
          </filter>
        </defs>
        <g id="grid"></g>
        <g id="shapes"></g>
        <g id="result"></g>
        <g id="handles"></g>
        <g id="overlay"></g>
      </svg>

      <!-- ✅ Show help on first load: removed "hidden" -->
      <div class="help" id="help">
        <div class="help__card" role="dialog" aria-modal="true" aria-label="Help">
          <h3>How to use</h3>
          <ul>
            <li><b>Pen</b>: Click to add points. <b>Enter</b> confirms as a closed polygon. <b>Esc</b> confirms as an open polyline.</li>
            <li><b>Rectangle / Regular polygon</b>: Drag to create.</li>
            <li><b>Select</b>: Click a shape to select. Drag vertices to edit. Drag inside to move.</li>
            <li><b>Run</b>: Computes Straight Skeleton from the selected closed shape (auto-detects “outer boundary + holes” if needed),
              then draws demo mountain/valley creases and the one-cut line.</li>
          </ul>

          <p class="help__note">
            Note: This is a learning demo to explore the “fold-and-cut” idea.
            It does not fully reproduce the complete Demaine-style construction steps (e.g., final reflection stacking) with strict correctness.
            But it lets you see the straight-skeleton-based crease generation feel.
          </p>

          <div class="row">
            <button class="btn btn--primary" id="helpClose" type="button">Close</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script type="module" src="js/app.js"></script>
</body>
</html>
